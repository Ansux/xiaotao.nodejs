Array.prototype.indexOf=function(t){for(var e=0;e<this.length;e++)if(this[e]==t)return e;return-1},Array.prototype.remove=function(t){var e=this.indexOf(t);e>-1&&this.splice(e,1)},Array.prototype.moveToFirst=function(t){var e=this.indexOf(t),r=this[e];this.splice(e,1),this.unshift(r)},angular.module("root",[],["$httpProvider",function(t){"use strict";t.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",t.defaults.transformRequest=[function(t){var e=function(t){var r,n,c,o,s,u,a,d="";for(r in t)if(n=t[r],n instanceof Array)for(a=0;a<n.length;++a)s=n[a],c=r+"["+a+"]",u={},u[c]=s,d+=e(u)+"&";else if(n instanceof Object)for(o in n)s=n[o],c=r+"["+o+"]",u={},u[c]=s,d+=e(u)+"&";else void 0!==n&&null!==n&&(d+=encodeURIComponent(r)+"="+encodeURIComponent(n)+"&");return d.length?d.substr(0,d.length-1):d};return angular.isObject(t)&&"[object File]"!==String(t)?e(t):t}]}]),angular.module("myCart",["root"]).controller("myCart",["$scope","$http","$q",function(t,e,r){"use strict";e.get("/student/getCart?t="+(new Date).getTime()).success(function(e){t.stores=e.stores}),t["delete"]=function(r,n){e.post("/student/ngcart",{action:"delete",product:n.product._id}).success(function(e){e===!0&&(r.prolist.remove(n),0===r.prolist.length&&t.stores.remove(r))})},t.check=function(e,r,n){var c=e.target.checked;r.checked=c,"all"===n?angular.forEach(r,function(t,e){t.checked=c,angular.forEach(t.prolist,function(t,e){t.checked=c})}):"store"===n&&angular.forEach(r.prolist,function(t,e){t.checked=c}),t.refreshChecked()},t.items=0,t.refreshChecked=function(){var e,r=0;angular.forEach(t.stores,function(t,n){var c=!0;angular.forEach(t.prolist,function(t,n){t.checked===!1||void 0===t.checked?c=!1:t.checked===!0&&(r+=1,e=!0)}),t.checked=c}),t.items=r,t.settle=e;var n=!0;angular.forEach(t.stores,function(t,e){t.checked!==!1&&void 0!==t.checked||(n=!1)}),t.stores.checked=n},t.cartNum=function(e,r){"minus"===r?e.number>1&&t.cartNumPost(e.product._id,r,null).then(function(t){t===!0&&(e.number-=1)}):"plus"===r&&(e.number<e.product.stock?t.cartNumPost(e.product._id,r,null).then(function(t){t===!0&&(e.number+=1)}):alert("数量已超过商品的库存量！"))},t.cartNumPost=function(t,n,c){var o=r.defer();return e.post("/student/ngcart",{product:t,action:n,number:c}).success(function(t){o.resolve(t)}),o.promise},t.changeNum=function(e){var r;r=e.number<1?1:e.number>e.product.stock?e.product.stock:e.number,t.cartNumPost(e.product._id,"num",r).then(function(t){t===!0&&(e.number=r)})},t.account=function(){var e=0,r=[];return angular.forEach(t.stores,function(t,n){angular.forEach(t.prolist,function(t,n){t.checked===!0&&(e+=t.number*t.product.price,r.push({product:t.product._id,number:t.number}))})}),t.products=r,e},t.submit=function(){var r=[];angular.forEach(t.stores,function(t,e){angular.forEach(t.prolist,function(t,e){t.checked&&r.push({product:t.product._id,number:t.number})})}),e.post("/student/settle",{carts:r}).success(function(t){})}}]),angular.module("myAddress",["root"]).controller("myAddress",["$scope","$http",function(t,e){"use strict";t.addr={},e.post("/student/area").success(function(e){t.areas=e,t.addr.area=e[0]._id}),t.getAddrs=function(){e.post("/student/address").success(function(e){t.addrs=e})},t.getAddrs(),t.submit=function(){var r=t.addr;e.post("/student/address/save",{addr:r}).success(function(e){t.addr={area:t.addr.area},t.getAddrs()})},t["delete"]=function(r,n){e.post("/student/address/delete",{id:n}).success(function(e){e===!0&&t.addrs.splice(r,1)})},t.edit=function(e){var r={_id:e._id,receiver:e.receiver,area:e.area._id,addr:e.addr,phone:e.phone,isDefault:e.isDefault};t.addr=r}}]),angular.module("mySettle",["root"]).controller("mySettle",["$scope","$http",function(t,e){"use strict";e.post("/student/address").success(function(e){var r={};angular.forEach(e,function(n,c){n.isDefault===!0&&(r=n,r.select=!0,e.splice(c,1),t.hasAddr=r)}),e.unshift(r),t.addrs=e}),t.select=function(e){e.select!==!0&&(angular.forEach(t.addrs,function(t,e){t.select===!0&&(t.select=void 0)}),e.select=!0,t.hasAddr=e)}}]);